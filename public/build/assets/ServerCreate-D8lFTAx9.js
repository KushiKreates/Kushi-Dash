import{q as I,r as g,W as se,j as e,y as re}from"./app-Dm8cIE4T.js";import{C as P,a as _,b as $,c as z,d as B}from"./card-BcIbXjuy.js";import{B as U}from"./button-DgGlTW6a.js";import{I as A}from"./input-CBzUmVr_.js";import{L as C}from"./label-Cskz7mPN.js";import{A as k,a as w}from"./alert-DHtm6IX7.js";import{A as V,a as F,b as H,c as O,d as T,e as q,f as Y}from"./alert-dialog-DWkt10LR.js";import{S as ae,M as te}from"./server-C8BrjQ9N.js";import{C as ne}from"./circle-check-B1MVLKFc.js";import{c as W}from"./createLucideIcon-Bdj_7l1A.js";import{C as X}from"./crown-DKCHU-mq.js";import{C as ce}from"./chevron-down-KYMX_7VK.js";import"./utils-BM_CldAA.js";import"./index-C_uji-SS.js";import"./index-BnBCp9FI.js";import"./index-DKrXWNRO.js";import"./index-DLTLx8j3.js";import"./index-C_FO5VxW.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=W("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=W("Hammer",[["path",{d:"m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9",key:"eefl8a"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"b7pghm"}]]);function De(){const{locations:a,eggs:c,auth:j}=I().props,[d,b]=g.useState({}),[f,p]=g.useState(!1),[y,v]=g.useState(!1),{flash:r}=I().props,{data:n,setData:m,post:G,processing:E,errors:L}=se({name:"",location_id:"",egg_id:"",memory:"",disk:"",cpu:"",databases:"",backups:"",allocations:""});j.user;const R=()=>{p(!1),re.visit("/dashboard")},M=()=>{v(!1)},J=()=>{r.server_url&&window.open(r.server_url,"_blank")},l=s=>{var o,t;const i=parseInt(((o=j.user.resources)==null?void 0:o[s])||0,10),x=parseInt(((t=j.user.limits)==null?void 0:t[s])||0,10);return Math.max(0,x-i)};g.useEffect(()=>{r!=null&&r.status&&(r.error?v(!0):p(!0))},[r]),g.useEffect(()=>{if(!Array.isArray(a)||a.length===0){//console.log ("No locations available");return}const s=async i=>{if(!i.latencyurl){//console.log ("No latency URL for location:",i.name);return}try{//console.log ("Checking ping for:",i.name);const x=[];for(let t=0;t<3;t++){const u=performance.now();await fetch(i.latencyUrl,{mode:"cors",cache:"no-cache",method:"HEAD"});const N=performance.now();x.push(N-u)}const o=Math.round(x.sort((t,u)=>t-u).slice(0,2).reduce((t,u)=>t+u,0)/2);//console.log ("Latency measurements:",x),//console.log ("Final latency:",o),b(t=>({...t,[i.id]:o}))}catch(x){console.error("Ping check failed:",x),b(o=>({...o,[i.id]:-1}))}};a.forEach(i=>s(i))},[a]);const K=s=>{if(s.maintenance)return e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-orange-500",children:[e.jsx(le,{size:16}),e.jsx("span",{children:"Maintenance"})]});switch(s.requiredRank){case"admin":return e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-red-500",children:[e.jsx(X,{size:16}),e.jsx("span",{children:"Admin"})]});case"premium":return e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-yellow-500",children:[e.jsx(X,{size:16}),e.jsx("span",{children:"Premium"})]});case"free":return e.jsx("div",{className:"flex items-center space-x-1 text-xs text-green-500",children:e.jsx("span",{children:"Free"})});default:return null}},Q=({eggs:s,value:i,onChange:x})=>{const[o,t]=g.useState(!1),u=g.useRef(null);g.useEffect(()=>{const h=ee=>{u.current&&!u.current.contains(ee.target)&&t(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]);const N=s.find(h=>h.id===i);return e.jsxs("div",{className:"relative",ref:u,children:[e.jsxs("button",{type:"button",onClick:()=>t(!o),className:`w-full flex items-center justify-between px-3 py-2 border rounded-md
                        bg-white dark:white 
                        text-black dark:text-black
                        hover:bg-gray-50 dark:hover:bg-zinc-700
                        transition-colors
                        ${o?"ring-2 ring-primary":""}`,children:[e.jsx("span",{className:"text-sm",children:N?N.name:"Select server type"}),e.jsx(ce,{className:`h-4 w-4 transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsx("div",{className:"absolute z-50 w-full mt-1 py-1 bg-white dark:bg-black border rounded-md shadow-lg",children:s.map(h=>e.jsx("button",{type:"button",onClick:()=>{x(h.id),t(!1)},className:`w-full text-left px-3 py-2 text-sm
                                    text-black dark:text-white
                                    hover:bg-gray-50 dark:hover:bg-zinc-700 rounded-lg
                                    ${i===h.id?"bg-gray-100 dark:bg-black":""}`,children:h.name},h.id))})]})},Z=s=>{s.preventDefault(),G(route("servers.store"))};return e.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(P,{children:[e.jsxs(_,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Server Details"]}),e.jsx(z,{children:"Basic server configuration"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"name",children:"Server Name"}),e.jsx(A,{id:"name",value:n.name,onChange:s=>m("name",s.target.value),placeholder:"My Awesome Server"}),L.name&&e.jsx(k,{variant:"destructive",children:e.jsx(w,{children:L.name})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Location"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:a.map(s=>e.jsxs("div",{className:`group flex flex-col p-4 bg-card border rounded-lg cursor-pointer transition-all duration-200 hover:bg-accent/50 hover:border-accent ${n.location_id===s.platform?"ring-2 ring-primary border-primary":""} ${s.maintenance?"opacity-50":""}`,onClick:()=>!s.maintenance&&m("location_id",s.platform),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("img",{src:s.flag,alt:`${s.name} flag`,className:"w-10 h-7 rounded-sm object-cover shadow-sm"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"mt-0.5",children:K(s)})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:s.description}),d[s.id]!==void 0&&e.jsxs("div",{className:`text-xs flex items-center gap-1.5 ${d[s.id]<170?"text-green-500":d[s.id]<500?"text-yellow-500":"text-red-500"}`,children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current"}),d[s.id]===-1?"Connection Error":`${d[s.id]}ms`]})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"text-black dark:text-white",children:"Server Type"}),e.jsx(Q,{eggs:c,value:n.egg_id,onChange:s=>m("egg_id",s)})]})]})]}),e.jsxs(P,{children:[e.jsxs(_,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Resources"]}),e.jsx(z,{children:"Server resource allocation"})]}),e.jsxs(B,{className:"space-y-6",children:[e.jsx(S,{label:"Memory",value:n.memory,onChange:s=>m("memory",s),min:128,max:l("memory"),step:128,remaining:l("memory")}),e.jsx(S,{label:"Disk",value:n.disk,onChange:s=>m("disk",s),min:512,max:l("disk"),remaining:l("disk")}),e.jsx(S,{label:"CPU",value:n.cpu,onChange:s=>m("cpu",s),min:10,max:l("cpu"),step:5,remaining:l("cpu")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(D,{label:"Databases",value:n.databases,onChange:s=>m("databases",s),max:l("databases"),remaining:l("databases")}),e.jsx(D,{label:"Backups",value:n.backups,onChange:s=>m("backups",s),min:0,max:l("backups"),remaining:l("backups")}),e.jsx(D,{label:"Ports",value:n.allocations,onChange:s=>m("allocations",s),min:0,max:l("allocations"),remaining:l("allocations")})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(U,{type:"submit",disabled:E,children:E?"Creating...":"Create Server"})}),e.jsx(V,{open:f,onOpenChange:R,children:e.jsxs(F,{className:"max-w-md",children:[e.jsxs(H,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-6 w-6 text-green-500"}),"Success!"]}),e.jsx(T,{className:"text-base",children:(r==null?void 0:r.status)||"Your server has been created successfully!"})]}),e.jsxs(q,{className:"flex gap-2",children:[e.jsx(Y,{onClick:R,children:"Continue"}),(r==null?void 0:r.server_url)&&e.jsx(U,{onClick:J,variant:"outline",children:"Access Server"})]})]})}),e.jsx(V,{open:y,onOpenChange:M,children:e.jsxs(F,{className:"max-w-md",children:[e.jsxs(H,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-6 w-6 text-red-500"}),"Error"]}),e.jsx(T,{className:"text-base",children:(r==null?void 0:r.status)||"Failed to create server. Please try again."})]}),e.jsx(q,{children:e.jsx(Y,{onClick:M,children:"Close"})})]})})]})}const S=({label:a,value:c,onChange:j,min:d,max:b,step:f,remaining:p})=>{const y=c===0?"":c,v=n=>{const m=n.target.value===""?"":parseInt(n.target.value);j(m)},r=c>p;return e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{type:"number",min:d,max:b,step:f,value:y,onChange:v,className:r?"border-red-500":""}),e.jsx("span",{className:"w-20 text-right",children:c?`${c}${a.includes("CPU")?"%":"MB"}`:"-"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Remaining: ",p,a.includes("CPU")?"%":"MB"]}),r&&e.jsx(k,{variant:"destructive",children:e.jsxs(w,{children:["You don't have enough ",a.toLowerCase()," resources available. Maximum: ",p]})}),c<d&&c!==""&&e.jsx(k,{variant:"destructive",children:e.jsxs(w,{children:["Minimum ",a.toLowerCase()," is ",d,a.includes("CPU")?"%":"MB"]})})]})},D=({label:a,value:c,onChange:j,min:d,max:b,remaining:f})=>{const p=c===0?"":c,y=r=>{const n=r.target.value===""?"":parseInt(r.target.value);j(n)},v=c>f;return e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a}),e.jsx(A,{type:"number",min:d,max:b,value:p,onChange:y,className:v?"border-red-500":""}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Remaining: ",f]}),v&&e.jsx(k,{variant:"destructive",children:e.jsxs(w,{children:["You don't have enough ",a.toLowerCase()," available. Maximum: ",f]})})]})};export{De as default};
