import{q as _,r as N,v as re,j as e,m as ae}from"./app-CPOEIljs.js";import{C as B,a as L,b as U,c as H,d as z}from"./card-Bgh2vyw6.js";import{B as F}from"./button-eEqjswbG.js";import{I as E}from"./input-DblQC-rj.js";import{L as y}from"./label-DOv-fn02.js";import{A as w,a as k}from"./alert-B7Y1C_SH.js";import{A as V,a as q,b as Y,c as O,d as T,e as X,f as G}from"./alert-dialog-CT-B0vup.js";import{S as te,M as ne}from"./server-AaV7efXc.js";import{C as ce}from"./circle-check-CubFW-9P.js";import{c as ie}from"./createLucideIcon-qc0XlodV.js";import{H as le}from"./hammer-CKFvTp5M.js";import{C as J}from"./crown-CKyATDpN.js";import"./utils-BM_CldAA.js";import"./index-B2vZC__5.js";import"./index-B7zntmxJ.js";import"./index-Cz6_P-h8.js";import"./index-ChuBIvQJ.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=ie("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function De(){var $;const{locations:t,eggs:n,auth:u}=_().props,[i,j]=N.useState({}),[h,m]=N.useState(!1),[b,p]=N.useState(!1),[g,v]=N.useState(null),{flash:r}=_().props,S=($=r==null?void 0:r.status)==null?void 0:$.includes("Error"),{data:x,setData:d,post:K,processing:M,errors:I}=re({name:"",location_id:"",egg_id:"",memory:"",disk:"",cpu:"",databases:"",backups:"",allocations:""});u.user;const R=()=>{m(!1),ae.visit("/dashboard")},Q=()=>{r.server_url&&window.open(r.server_url,"_blank")},P=()=>{p(!1)},c=s=>{var f,l;const o=parseInt(((f=u.user.resources)==null?void 0:f[s])||0,10),a=parseInt(((l=u.user.limits)==null?void 0:l[s])||0,10);return Math.max(0,a-o)};N.useEffect(()=>{r!=null&&r.status&&(S?p(!0):m(!0))},[r==null?void 0:r.status,S]),N.useEffect(()=>{if(!Array.isArray(t)||t.length===0)return;const s=async o=>{if(o.latencyurl)try{const a=[];for(let l=0;l<3;l++){const C=performance.now();await fetch(o.latencyUrl,{mode:"cors",cache:"no-cache",method:"HEAD"});const se=performance.now();a.push(se-C)}const f=Math.round(a.sort((l,C)=>l-C).slice(0,2).reduce((l,C)=>l+C,0)/2);j(l=>({...l,[o.id]:f}))}catch(a){console.error("Ping check failed:",a),j(f=>({...f,[o.id]:-1}))}};t.forEach(o=>s(o))},[t]);const W=s=>{if(s.maintenance)return e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-orange-500",children:[e.jsx(le,{size:16}),e.jsx("span",{children:"Maintenance"})]});switch(s.requiredRank){case"admin":return e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-red-500",children:[e.jsx(J,{size:16}),e.jsx("span",{children:"Admin"})]});case"premium":return e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-yellow-500",children:[e.jsx(J,{size:16}),e.jsx("span",{children:"Premium"})]});case"free":return e.jsx("div",{className:"flex items-center space-x-1 text-xs text-green-500",children:e.jsx("span",{children:"Free"})});default:return null}},Z=({eggs:s,onSelectEgg:o})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:s.map(a=>e.jsx("div",{className:`relative rounded-lg overflow-hidden cursor-pointer transition-transform hover:scale-105 ${g===a.id?"ring-4 ring-blue-500":""}`,onClick:()=>o(a.id),style:{minHeight:"200px",background:a.imageUrl?`url(${a.imageUrl}) center/cover`:"#f0f0f0"},children:e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-60 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[a.icon&&e.jsx("img",{src:a.icon,alt:`${a.name} icon`,className:"w-8 h-8 object-contain"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:a.name})]}),e.jsx("p",{className:"text-sm text-gray-200 line-clamp-3",children:a.description})]})},a.id))}),ee=s=>{s.preventDefault(),K(route("servers.store"))};return e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(B,{children:[e.jsxs(L,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Server Details"]}),e.jsx(H,{children:"Basic server configuration"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",children:"Server Name"}),e.jsx(E,{id:"name",value:x.name,onChange:s=>d("name",s.target.value),placeholder:"My Awesome Server"}),I.name&&e.jsx(w,{variant:"destructive",children:e.jsx(k,{children:I.name})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Location"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:t.map(s=>e.jsxs("div",{className:`group flex flex-col p-4 bg-card border rounded-lg cursor-pointer transition-all duration-200 hover:bg-accent/50 hover:border-accent ${x.location_id===s.platform?"ring-2 ring-primary border-primary":""} ${s.maintenance?"opacity-50":""}`,onClick:()=>!s.maintenance&&d("location_id",s.platform),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("img",{src:s.flag,alt:`${s.name} flag`,className:"w-10 h-7 rounded-sm object-cover shadow-sm"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"mt-0.5",children:W(s)})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:s.description}),i[s.id]!==void 0&&e.jsxs("div",{className:`text-xs flex items-center gap-1.5 ${i[s.id]<170?"text-green-500":i[s.id]<500?"text-yellow-500":"text-red-500"}`,children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current"}),i[s.id]===-1?"Connection Error":`${i[s.id]}ms`]})]},s.id))})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(Z,{eggs:n,onSelectEgg:s=>{v(s),d("egg_id",s)}})})]})]}),e.jsxs(B,{children:[e.jsxs(L,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Resources"]}),e.jsx(H,{children:"Server resource allocation"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsx(D,{label:"Memory",value:x.memory,onChange:s=>d("memory",s),min:128,max:c("memory"),step:128,remaining:c("memory")}),e.jsx(D,{label:"Disk",value:x.disk,onChange:s=>d("disk",s),min:512,max:c("disk"),remaining:c("disk")}),e.jsx(D,{label:"CPU",value:x.cpu,onChange:s=>d("cpu",s),min:10,max:c("cpu"),step:5,remaining:c("cpu")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(A,{label:"Databases",value:x.databases,onChange:s=>d("databases",s),max:c("databases"),remaining:c("databases")}),e.jsx(A,{label:"Backups",value:x.backups,onChange:s=>d("backups",s),min:0,max:c("backups"),remaining:c("backups")}),e.jsx(A,{label:"Ports",value:x.allocations,onChange:s=>d("allocations",s),min:0,max:c("allocations"),remaining:c("allocations")})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(F,{type:"submit",disabled:M,children:M?"Creating...":"Create Server"})}),e.jsx(V,{open:!S&&h,onOpenChange:R,children:e.jsxs(q,{className:"max-w-md",children:[e.jsxs(Y,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-6 w-6 text-green-500"}),"Success!"]}),e.jsx(T,{className:"text-base",children:(r==null?void 0:r.status)||"Your server has been created successfully!"})]}),e.jsxs(X,{className:"flex gap-2",children:[e.jsx(G,{onClick:R,children:"Continue"}),(r==null?void 0:r.server_url)&&e.jsx(F,{onClick:Q,variant:"outline",children:"Access Server"})]})]})}),e.jsx(V,{open:b,onOpenChange:P,children:e.jsxs(q,{className:"max-w-md rounded-lg shadow-lg shadow-orange-950",children:[e.jsxs(Y,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-6 w-6 text-red-500"}),"Error"]}),e.jsx(T,{className:"text-base",children:(r==null?void 0:r.status)||"Failed to create server. Please try again."})]}),e.jsx(X,{children:e.jsx(G,{onClick:P,children:"Close"})})]})})]})}const D=({label:t,value:n,onChange:u,min:i,max:j,step:h,remaining:m})=>{const b=n===0?"":n,p=v=>{const r=v.target.value===""?"":parseInt(v.target.value);u(r)},g=n>m;return e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:t}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{type:"number",min:i,max:j,step:h,value:b,onChange:p,className:g?"border-red-500":""}),e.jsx("span",{className:"w-20 text-right",children:n?`${n}${t.includes("CPU")?"%":"MB"}`:"-"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Remaining: ",m,t.includes("CPU")?"%":"MB"]}),g&&e.jsx(w,{variant:"destructive",children:e.jsxs(k,{children:["You don't have enough ",t.toLowerCase()," resources available. Maximum: ",m]})}),n<i&&n!==""&&e.jsx(w,{variant:"destructive",children:e.jsxs(k,{children:["Minimum ",t.toLowerCase()," is ",i,t.includes("CPU")?"%":"MB"]})})]})},A=({label:t,value:n,onChange:u,min:i,max:j,remaining:h})=>{const m=n===0?"":n,b=g=>{const v=g.target.value===""?"":parseInt(g.target.value);u(v)},p=n>h;return e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:t}),e.jsx(E,{type:"number",min:i,max:j,value:m,onChange:b,className:p?"border-red-500":""}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Remaining: ",h]}),p&&e.jsx(w,{variant:"destructive",children:e.jsxs(k,{children:["You don't have enough ",t.toLowerCase()," available. Maximum: ",h]})})]})};export{De as default};
