import{W as H,q as M,r as c,j as e,b as q,y as L}from"./app-Dm8cIE4T.js";import{C as z,a as W,b as G,c as J,d as K}from"./card-BcIbXjuy.js";import{B as j}from"./button-DgGlTW6a.js";import{I as E}from"./input-CBzUmVr_.js";import{L as f}from"./label-Cskz7mPN.js";import{A as Q,a as X}from"./alert-DHtm6IX7.js";import{A as Y,a as Z,b as ee,c as se,d as ae,e as re,f as te}from"./alert-dialog-DWkt10LR.js";import{L as ne}from"./loading-screen-D__ngmPk.js";import{C as S}from"./circle-check-B1MVLKFc.js";import{L as ie}from"./loader-circle-Bkkx-D_Q.js";import"./utils-BM_CldAA.js";import"./index-C_uji-SS.js";import"./index-BnBCp9FI.js";import"./index-DKrXWNRO.js";import"./index-DLTLx8j3.js";import"./index-C_FO5VxW.js";import"./proxy-BqRsr-Q7.js";import"./createLucideIcon-Bdj_7l1A.js";function Re({userId:u="1"}){const{data:i,setData:l,put:A,processing:v,errors:h,reset:U}=H({newName:"",newEmail:"",newDiscordId:"",newRank:"free",newCoins:"",newPterodactylId:"",newResources:{},newLimits:{},planIds:[]}),{flash:p}=M().props,[d,w]=c.useState(null),[P,C]=c.useState(!1),[g,$]=c.useState(!0),[b,y]=c.useState(!1),[N,F]=c.useState([]),[o,R]=c.useState([]);c.useEffect(()=>{(async()=>{try{const t=await q.get("/admin/api/plans");F(t.data.plans)}catch(t){console.error("Failed to fetch plans:",t)}})()},[]);const O=()=>{confirm("Are you sure you want to delete this user? This action cannot be undone.")&&L.delete(`/admin/users/${u}`,{onSuccess:()=>{L.visit("/admin/users")},onError:s=>{w({type:"error",message:"Failed to delete user"})}})};c.useEffect(()=>{u&&g&&(async()=>{try{const a=await(await fetch(`/admin/api/users/${u}`)).json();l({newName:a.name,newPterodactylId:a.pterodactyl_id,newEmail:a.email,newDiscordId:a.discord_id,newRank:a.rank||"free",newCoins:a.coins||0,newResources:a.resources||{},newLimits:a.limits||{},planIds:a.purchases_plans||[]}),R(a.purchases_plans||[]),$(!1)}catch(t){console.error("Error fetching user:",t)}})()},[u,g,l]),c.useEffect(()=>{if(p.status)if(w({message:p.res,type:p.status}),p.status==="success")y(!0);else{const s=setTimeout(()=>w(null),5e3);return()=>clearTimeout(s)}},[p]),c.useEffect(()=>{b&&C(!0)},[b]);const T=async s=>{s.preventDefault();try{await A(`/admin/api/users/${u}/update`)}catch{console.error("An error occurred while submitting the form.")}},_=s=>{l("newRank",s)},D=()=>{C(!1),U(),y(!1)},V=s=>{const t=o.includes(s.id);let a,r={...i.newLimits};t?(a=o.filter(n=>n!==s.id),Object.keys(s.resources).forEach(n=>{r[n]=Math.max(0,parseInt(r[n]||0,10)-parseInt(s.resources[n]||0,10))})):(a=[...o,s.id],Object.keys(s.resources).forEach(n=>{r[n]=parseInt(r[n]||0,10)+parseInt(s.resources[n]||0,10)})),R(a),l(n=>({...n,newLimits:r,planIds:a,newRank:n.newRank==="admin"?"admin":a.length>0?"premium":"free"}))},k=()=>{let s={...i.newLimits};o.forEach(t=>{const a=N.find(r=>r.id===t);a&&Object.keys(a.resources).forEach(r=>{const n=parseInt(s[r]||0,10),m=parseInt(a.resources[r]||0,10);s[r]=n+m})}),l("newLimits",s)},B=()=>{let s={...i.newLimits};o.forEach(t=>{const a=N.find(r=>r.id===t);a&&Object.keys(a.resources).forEach(r=>{const n=parseInt(s[r]||0,10),m=parseInt(a.resources[r]||0,10);s[r]=Math.max(0,n-m)})}),l("newLimits",s)},x=(s,t,a,r="text")=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:s,children:t}),e.jsx(E,{id:s,type:r,value:a,onChange:n=>l(s,n.target.value),placeholder:`Enter user's ${t.toLowerCase()}`,className:h[s]?"border-red-500":""}),h[s]&&e.jsx("p",{className:"text-xs text-red-500",children:h[s]})]}),I=(s,t,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:a}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.keys(t).map(r=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:`${s}_${r}`,children:`${r.charAt(0).toUpperCase()+r.slice(1)}`}),e.jsx(E,{id:`${s}_${r}`,type:"number",value:t[r],onChange:n=>{const m=parseInt(n.target.value,10);l(s,{...t,[r]:isNaN(m)?0:m})},placeholder:`${r.charAt(0).toUpperCase()+r.slice(1)} Limit`})]},r))})]});return g?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(ne,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{className:"w-full max-w-4xl mx-auto",children:[e.jsxs(W,{children:[e.jsx(G,{children:"Update User"}),e.jsx(J,{children:"Update the details for this user"})]}),e.jsxs(K,{children:[d&&d.type!=="success"&&e.jsx(Q,{variant:"destructive",className:"mb-6",children:e.jsx(X,{children:d.message})}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[x("newName","Name",i.newName),x("newEmail","Email",i.newEmail,"email"),x("newPterodactylId","Pterodactyl Id",i.newPterodactylId,"number"),x("newDiscordId","Discord ID",i.newDiscordId),x("newCoins","Coins",i.newCoins,"number")]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Rank"}),e.jsx("div",{className:"flex gap-2",children:["free","premium","admin"].map(s=>e.jsx(j,{type:"button",variant:i.newRank===s?"default":"outline",onClick:()=>_(s),children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),h.newRank&&e.jsx("p",{className:"text-xs text-red-500",children:h.newRank})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{children:"Server Plans"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(s=>e.jsxs("div",{className:`relative p-4 border rounded-lg cursor-pointer transition-all ${o.includes(s.id)?"border-primary bg-primary/10":"hover:border-primary/50"}`,onClick:()=>V(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.icon&&e.jsx("img",{src:s.icon,alt:s.name,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsx("div",{className:"mt-3 space-y-1 text-sm",children:Object.entries(s.resources).map(([t,a])=>a>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"capitalize",children:[t,":"]}),e.jsx("span",{className:"font-medium",children:a})]},t))}),o.includes(s.id)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(S,{className:"h-5 w-5 text-primary"})})]},s.id))}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(j,{onClick:k,children:"Readd Plan Resources"}),e.jsx(j,{onClick:B,children:"Remove Plan Resources"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[I("newResources",i.newResources,"Resources"),I("newLimits",i.newLimits,"Limits")]}),e.jsx(j,{type:"button",variant:"destructive",onClick:O,className:"flex-1",children:"Delete User"}),e.jsx(j,{type:"submit",className:"w-full",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update User"})]})]})]}),e.jsx(Y,{open:P,onOpenChange:D,children:e.jsxs(Z,{className:"max-w-md",children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6 text-green-500"}),"Success!"]}),e.jsx(ae,{className:"text-base",children:(d==null?void 0:d.message)||"User details have been successfully updated!"})]}),e.jsx(re,{children:e.jsx(te,{onClick:D,children:"Continue"})})]})})]})}export{Re as default};
