import{r as i,q as j,v as I,j as e,b as g}from"./app-CPOEIljs.js";import{C as $}from"./card-Bgh2vyw6.js";import{A as d,a as m}from"./alert-B7Y1C_SH.js";import{L as l}from"./label-DOv-fn02.js";import{I as u}from"./input-DblQC-rj.js";import{B as A}from"./button-eEqjswbG.js";import{S as U}from"./switch-BKsmGszV.js";import{D as _,a as B,b as H,c as O}from"./dialog-CagruWET.js";import{L as T}from"./loader-circle-ChjTYIog.js";import"./utils-BM_CldAA.js";import"./index-B2vZC__5.js";import"./index-CZqrbxx3.js";import"./index-B7zntmxJ.js";import"./index-Cz6_P-h8.js";import"./index-ChuBIvQJ.js";import"./react-icons.esm-CK1D20Wk.js";import"./createLucideIcon-qc0XlodV.js";const ce=()=>{var f;const[v,S]=i.useState(!0),[b,y]=i.useState([]),[L,C]=i.useState(!0),[N,q]=i.useState(null),[E,h]=i.useState(!1),{location:c,flash:F}=j().props,D=c.id,p=j().props.location.id,{data:n,setData:x,put:k,errors:t}=I({name:"",location:"",servers:0,flag:"",maxservers:0,latencyurl:"",requiredRank:"",maintenance:!1,requiredSubscriptions:[],platform:"",platform_settings:null});i.useEffect(()=>{var r;const s=((r=c==null?void 0:c.flash)==null?void 0:r.success)??null;h(!!s)},[(f=c==null?void 0:c.flash)==null?void 0:f.success]);const w=s=>{const r=n.requiredSubscriptions.includes(s)?n.requiredSubscriptions.filter(a=>a!==s):[...n.requiredSubscriptions,s];o("requiredSubscriptions",r)},M=()=>e.jsx(_,{open:E,onOpenChange:h,children:e.jsxs(B,{children:[e.jsx(H,{children:e.jsx(O,{children:"Success"})}),e.jsx(d,{children:e.jsx(m,{children:F.success})})]})});i.useEffect(()=>{(async()=>{try{const a=(await g.get(`/admin/api/locations/${p}`)).data.location;x(R=>({...R,name:a.name,location:a.location,servers:a.servers,flag:a.flag,maxservers:a.maxservers,latencyurl:a.latencyurl,requiredRank:a.requiredRank,maintenance:a.maintenance,requiredSubscriptions:a.requiredSubscriptions,platform:a.platform,platform_settings:a.platform_settings}))}catch(r){console.error("Error fetching location:",r)}finally{S(!1)}})()},[p]),i.useEffect(()=>{(async()=>{try{const r=await g.get("/admin/api/plans");y(r.data.plans||[])}catch{q("Failed to load plans.")}finally{C(!1)}})()},[]);const P=s=>{s.preventDefault(),k(`/admin/locations/${D}`,{data:n,onSuccess:()=>{h(!0)},onError:r=>{console.error("Error updating location:",r)}})},o=(s,r)=>{x(a=>({...a,[s]:r}))};return v?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(T,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading location..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Name"}),e.jsx(u,{id:"name",value:n.name,onChange:s=>o("name",s.target.value),placeholder:"Location name"}),t.name&&e.jsx(d,{variant:"destructive",children:e.jsx(m,{children:t.name})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"location",children:"Location"}),e.jsx(u,{id:"location",value:n.location,onChange:s=>o("location",s.target.value),placeholder:"Physical location"}),t.location&&e.jsx(d,{variant:"destructive",children:e.jsx(m,{children:t.location})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"flag",children:"Flag URL"}),e.jsx(u,{id:"flag",value:n.flag,onChange:s=>o("flag",s.target.value),placeholder:"Flag image URL"}),t.flag&&e.jsx(d,{variant:"destructive",children:e.jsx(m,{children:t.flag})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"maxservers",children:"Max Servers"}),e.jsx(u,{id:"maxservers",type:"number",value:n.maxservers,onChange:s=>o("maxservers",parseInt(s.target.value)),placeholder:"Maximum servers allowed"}),t.maxservers&&e.jsx(d,{variant:"destructive",children:e.jsx(m,{children:t.maxservers})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"maintenance",children:"Maintenance Mode"}),e.jsx(U,{id:"maintenance",checked:n.maintenance,onCheckedChange:s=>o("maintenance",s)})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs($,{children:[e.jsx(l,{children:"Required Subscriptions"}),!L&&!N&&e.jsx("div",{className:"flex flex-col  mt-3 mb-4 mr-3",children:b.map(s=>e.jsxs("div",{className:"flex items-center mr-3",children:[e.jsx("input",{id:`plan-${s.id}`,type:"checkbox",checked:n.requiredSubscriptions.includes(s.id),onChange:()=>w(s.id),className:"mr-2"}),e.jsx("label",{htmlFor:`plan-${s.id}`,children:s.name})]},s.id))})]})}),e.jsx(A,{type:"submit",className:"w-full",children:"Update Location ðŸ“¦"})]}),e.jsx(M,{})]})};export{ce as default};
